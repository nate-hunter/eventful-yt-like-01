# Migration `20211120003005-initial`

This migration has been generated by Nate Hunter at 11/19/2021, 7:30:05 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "username" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "avatar" TEXT NOT NULL DEFAULT E'https://res.cloudinary.com/pandaboogie/image/upload/v1622005978/yflfl23hfjgcub7ykwd7.jpg',
    "cover" TEXT NOT NULL DEFAULT E'https://res.cloudinary.com/pandaboogie/image/upload/v1637348347/event-01_xm6xsi.jpg',
    "about" TEXT NOT NULL DEFAULT E'',

    PRIMARY KEY ("id")
)

CREATE TABLE "Comment" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "text" TEXT NOT NULL,
    "userId" TEXT NOT NULL,
    "videoId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Subscription" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "subscriberId" TEXT NOT NULL,
    "subscribedToId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Video" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "title" TEXT NOT NULL,
    "description" TEXT,
    "url" TEXT NOT NULL,
    "thumbnail" TEXT NOT NULL,
    "userId" TEXT NOT NULL,
    "eventDate" TIMESTAMP(3),
    "venue" TEXT,
    "location" TEXT,
    "lat" DECIMAL(65,30),
    "lon" DECIMAL(65,30),

    PRIMARY KEY ("id")
)

CREATE TABLE "VideoLike" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "like" INTEGER NOT NULL DEFAULT 0,
    "userId" TEXT NOT NULL,
    "videoId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "View" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" TEXT,
    "videoId" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Category" (
    "id" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "name" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_CategoryToVideo" (
    "A" TEXT NOT NULL,
    "B" TEXT NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "_CategoryToVideo_AB_unique" ON "_CategoryToVideo"("A", "B")

CREATE INDEX "_CategoryToVideo_B_index" ON "_CategoryToVideo"("B")

ALTER TABLE "Comment" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Comment" ADD FOREIGN KEY("videoId")REFERENCES "Video"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Subscription" ADD FOREIGN KEY("subscriberId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Subscription" ADD FOREIGN KEY("subscribedToId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Video" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "VideoLike" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "VideoLike" ADD FOREIGN KEY("videoId")REFERENCES "Video"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "View" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "View" ADD FOREIGN KEY("videoId")REFERENCES "Video"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_CategoryToVideo" ADD FOREIGN KEY("A")REFERENCES "Category"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_CategoryToVideo" ADD FOREIGN KEY("B")REFERENCES "Video"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20211120003005-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,89 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id           String         @id @default(uuid())
+  createdAt    DateTime       @default(now())
+  username     String
+  email        String         @unique
+  avatar       String         @default("https://res.cloudinary.com/pandaboogie/image/upload/v1622005978/yflfl23hfjgcub7ykwd7.jpg")
+  cover        String         @default("https://res.cloudinary.com/pandaboogie/image/upload/v1637348347/event-01_xm6xsi.jpg")
+  about        String         @default("")
+  videos       Video[]
+  videoLikes   VideoLike[]
+  comments     Comment[]
+  subscribers  Subscription[] @relation("subscriber")
+  subscribedTo Subscription[] @relation("subscribedTo")
+  views        View[]
+}
+
+model Comment {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  text      String
+  userId    String
+  videoId   String
+  user      User     @relation(fields: [userId], references: [id])
+  video     Video    @relation(fields: [videoId], references: [id])
+}
+
+model Subscription {
+  id             String   @id @default(uuid())
+  createdAt      DateTime @default(now())
+  subscriberId   String
+  subscribedToId String
+  subscriber     User     @relation("subscriber", fields: [subscriberId], references: [id])
+  subscribedTo   User     @relation("subscribedTo", fields: [subscribedToId], references: [id])
+}
+
+model Video {
+  id          String      @id @default(uuid())
+  createdAt   DateTime    @default(now())
+  title       String
+  description String?
+  url         String
+  thumbnail   String
+  userId      String
+  eventDate   DateTime?
+  venue       String?
+  location    String?
+  lat         Float?
+  lon         Float?
+  user        User        @relation(fields: [userId], references: [id])
+  videoLikes  VideoLike[]
+  comments    Comment[]
+  views       View[]
+  categories  Category[]  @relation(references: [id])
+}
+
+model VideoLike {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  like      Int      @default(0)
+  userId    String
+  videoId   String
+  user      User     @relation(fields: [userId], references: [id])
+  video     Video    @relation(fields: [videoId], references: [id])
+}
+
+model View {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  userId    String?
+  videoId   String
+  user      User?    @relation(fields: [userId], references: [id])
+  video     Video    @relation(fields: [videoId], references: [id])
+}
+
+model Category {
+  id        String   @id @default(uuid())
+  createdAt DateTime @default(now())
+  name      String
+  videos    Video[]  @relation(references: [id])
+}
```


